<h1 class="centered-title"><%= @user ? @user.name : 'ユーザーが見つかりません' %> さん</h1>

<% if @user %>
  <p class="user-info"><strong>生年月日:</strong> <%= @user.birthday&.strftime("%Y-%m-%d") %></p>
  
  <% if @user.birthday %>
    <% age, months = @user.age_with_months %>
    <p class="user-info"><strong>年齢:</strong> <%= age %> 歳 <%= months %> ヶ月</p>
  <% else %>
    <p class="user-info">生年月日がありません。</p>
  <% end %>
<% else %>
  <p>ユーザーが見つかりません。</p>
<% end %>

<h2 class="centered-title">体調記録</h2>

<!-- 体調記録の表示 -->
<% if @conditions.any? %>
  <table class="record-table">
    <% @conditions.each do |condition| %>
      <tr>
        <td style="padding: 10px; vertical-align: top;">
          <strong>記録日時:</strong> <%= condition.input_day.strftime("%Y-%m-%d") %> <br>
          <strong>体温:</strong> <%= condition.temperature %>°C <br>
          <strong>食欲:</strong> <%= condition.eat || '記録なし' %> <br>
          <strong>水分:</strong> <%= condition.moisture || '記録なし' %> <br>
          <strong>嘔吐:</strong> <%= condition.puke || '記録なし' %> <br>
          <strong>メモ:</strong> <%= condition.memo || '記録なし' %> <br>
        </td>

        <td style="width: 30%; vertical-align: top; text-align: right; padding: 10px;">
          <% if condition.images.attached? %>
            <strong>画像:</strong>
            <div class="record-image" style="display: inline-block; margin-right: 10px;">
              <% condition.images.each do |image| %>
                <%= image_tag image.variant(resize_to_limit: [50, 50]), class: 'record-image-small' %>
              <% end %>
            </div>
          <% else %>
            <p>画像が添付されていません。</p>
          <% end %>
          <div style="display: inline-block; margin-left: 10px;">
            <%= link_to '編集', edit_condition_path(condition), data: { turbo: false }, class: 'btn btn-primary' %>
            <%= button_to '削除', condition_path(condition), method: :delete, data: { confirm: '本当に削除しますか？', turbo: false }, class: 'btn btn-danger', style: 'margin-left: 10px;' %>
          </div>
        </td>
      </tr>
    <% end %>
  </table>
<% else %>
  <p>体調記録がありません。</p>
<% end %>


<!-- 体調記録の新規入力フォーム -->
<h3 class="centered-title">新しい体調記録を入力</h3>
<%= form_with model: Condition.new(user: @user), url: conditions_path, local: true, multipart: true do |form| %>
  <%= form.hidden_field :user_id, value: @user.id %>
  <div>
    <%= form.label :input_day, '記録日時' %>
    <%= form.date_field :input_day, required: true %>
  </div>
  <div>
    <%= form.label :temperature, '体温' %>
    <%= form.number_field :temperature, step: 0.1, required: true %>
  </div>
  <div>
    <%= form.label :eat, '食欲' %>
    <%= form.text_field :eat %>
  </div>
  <div>
    <%= form.label :moisture, '水分' %>
    <%= form.text_field :moisture %>
  </div>
  <div>
    <%= form.label :puke, '嘔吐' %>
    <%= form.text_field :puke %>
  </div>
  <div>
    <%= form.label :memo, 'メモ' %>
    <%= form.text_area :memo %>
  </div>
  <div>
    <%= form.label :images, '画像（複数選択可）' %>
    <%= form.file_field :images, multiple: true, accept: 'image/*' %>
  </div>
  <%= form.submit '作成', class: 'btn btn-success' %>
<% end %>
